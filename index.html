<html>
	<head>
		<title>Countdown</title>
		<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
		<script type="text/javascript">
			function extract_date(obj) {
				var n = obj.attr('targ').split(',');
				var d = new Date(n[0],n[1],n[2],n[3],n[4],n[5],n[6]);
				return d;
			}
			function timeDiff(target) {
				var string = "";
				//get time
				var now = new Date();
				var val = now.getTime();
				
				//calculate time remaining
				var diff;
				if(val >= target){
					diff = val - target;
					string += "-";
				}
				else{
					diff = target - val;
				}
				
				//parse into time units
				var days = Math.floor(diff / 86400000);
				diff %= 86400000;
				var hours = Math.floor(diff / 3600000);
				diff %= 3600000;
				var minutes = Math.floor(diff / 60000);
				diff %= 60000;
				var seconds = Math.floor(diff / 1000);
				diff %= 1000;
				//diff is now the miliseconds;
				diff = Math.floor(diff);
				
				//print the result
				string += days.toString()+":";
				if(hours<10){string += '0';}
				string += hours.toString()+":";
				if(minutes<10){string += '0';}
				string += minutes.toString()+":";
				if(seconds<10){string += '0';}
				string += seconds.toString();
				
				return string;
			}
			function generateUpdate(obj){
				//var n = obj.attr('targ').split(',');
				//var d = new Date(n[0],n[1],n[2],n[3],n[4],n[5],n[6]);
				var target = extract_date(obj);
				obj.children('.itemname').html(obj.children('.itemname').html()+'<span>'+target+'</span>');
				return (function () {
					obj.children('.itemcountdown').html(timeDiff(target));
				});
			}
			function generatePrimary() {
				var allitems = [];
				$('div.item').each(function () {
					allitems.push(generateUpdate($(this)));
				});
				return (function () {
					var i=0, l = allitems.length;
					for(i=0; i < l; i++){
						allitems[i]();
					}
				});
			}
			$(function (){
				setInterval(generatePrimary(), 1000);
			});
		</script>
		<style type="text/css">
			body {
				font-family:sans-serif;
			}
			.item {
				margin-bottom:20px;
			}
			.itemname {
				font-size:large;
			}
			.itemname span {
				font-size:small;
				margin-left:10px;
			}
			.itemdescr {
				font-size:small;
				font-style:italic;
			}
			.itemcountdown {
				font-size:x-large;
				font-weight:bold;
			}
		</style>
	</head>
	<body>
	<div class="item" targ="2011,8,8,21,0,0,0">
		<div class="itemname" id="bedtime_n">bedtime</div>
		<div class="itemdescr" id="bedtime_d"></div>
		<div class="itemcountdown" id="bedtime_cd"></div>
	</div>
	<div class="item" targ="2011,8,12,22,30,0,0">
		<div class="itemname" id="website_n">website online</div>
		<div class="itemdescr" id="website_d">and online now!</div>
		<div class="itemcountdown" id="website_cd"></div>
	</div>
	</body>
</html>
